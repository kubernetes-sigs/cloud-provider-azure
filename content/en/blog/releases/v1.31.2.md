---
title: v1.31.2
linkTitle: v1.31.2
date: 2025-02-21
description: Cloud Provider Azure v1.31.2
---
Full Changelog: [v1.31.1..v1.31.2](https://github.com/kubernetes-sigs/cloud-provider-azure/compare/v1.31.1...v1.31.2)

## Changes by Kind

### Testing

- Fix: revert to go1.22 windows filesystem stdlib behavior building with go 1.23 ([#7751](https://github.com/kubernetes-sigs/cloud-provider-azure/pull/7751), [@k8s-infra-cherrypick-robot](https://github.com/k8s-infra-cherrypick-robot))

### Feature

- Feat: Lock updates on azure resources when other component is doing the same thing.
  
  This PR utilizes a lease in each service reconciliation to prevent race conditions where cloud provider and others are updating the same azure resources. ([#7341](https://github.com/kubernetes-sigs/cloud-provider-azure/pull/7341), [@nilo19](https://github.com/nilo19))
- Feat: match source account as first priority in snapshot restore and volume clone scenarios ([#7700](https://github.com/kubernetes-sigs/cloud-provider-azure/pull/7700), [@k8s-infra-cherrypick-robot](https://github.com/k8s-infra-cherrypick-robot))
- [credential provider] Add a flag mirrorMapping. This flag is to mirror registry A to B when fetching credential. ([#7335](https://github.com/kubernetes-sigs/cloud-provider-azure/pull/7335), [@k8s-infra-cherrypick-robot](https://github.com/k8s-infra-cherrypick-robot))

### Bug or Regression

- Fix checking service references from `tags` when deleting PIP ([#7263](https://github.com/kubernetes-sigs/cloud-provider-azure/pull/7263), [@zarvd](https://github.com/zarvd))
- Fix: Change the order of updating vmss vm and vmss ([#7539](https://github.com/kubernetes-sigs/cloud-provider-azure/pull/7539), [@k8s-infra-cherrypick-robot](https://github.com/k8s-infra-cherrypick-robot))
- Fix: Support switching from loadbalancer to externalName for services ([#7565](https://github.com/kubernetes-sigs/cloud-provider-azure/pull/7565), [@k8s-infra-cherrypick-robot](https://github.com/k8s-infra-cherrypick-robot))
- Fix: several bugs related to multiple standard load balancers mode.
  1. All endpointslices of a local service should be included in local backend pool updater, instead of only the first endpointslice.
  2. In some rare cases, migration from NIC to IP-based LB can be in a middle state where the NIC references are removed, but those IPConfigs in the backend pool are not. In this case, we should manually exclude those IPConfigs from the request body.
  3. localServiceOwnsBackendPool should compare the full backend pool name, not just prefix, because two service names can share the same prefix.
  4. There is a corner case when the cluster is being updated to multi-slb from classic NIC-based single lb, not from an IP-based cluster. In this case, if the service being reconciled is local, the cloud provider will try to update a NIC pool to IP-based pool direct, which is not allowed. We should skip adding IPs to NIC-based pool in multi-slb mode.
  5. There is a bug in ReconcileBackendPools, where we by mistake parse the LB name to use as the backend pool name. ([#7605](https://github.com/kubernetes-sigs/cloud-provider-azure/pull/7605), [@k8s-infra-cherrypick-robot](https://github.com/k8s-infra-cherrypick-robot))
- Introduced **prefix-based matching** for `systemTags` during tag reconciliation.
  - Tags starting with a prefix defined in `systemTags` (e.g., `aks-managed`) will now be matched and retained.
  - For example:  Adding `aks-managed` to `systemTags` ensures tags like `aks-managed-cluster-name` and `aks-managed-cluster-rg` are preserved. ([#8147](https://github.com/kubernetes-sigs/cloud-provider-azure/pull/8147), [@k8s-infra-cherrypick-robot](https://github.com/k8s-infra-cherrypick-robot))
- Tags with values resembling "null" (e.g., " null " or " NuLL ") will now retain their leading and trailing whitespace during inheritance or updates to avoid errors caused by ARM's reserved tag value "null". 
  This change only affects tags with such specific values, ensuring all other tags continue to have whitespace trimmed as before. ([#8118](https://github.com/kubernetes-sigs/cloud-provider-azure/pull/8118), [@k8s-infra-cherrypick-robot](https://github.com/k8s-infra-cherrypick-robot))

### Other (Cleanup or Flake)

- Optimize CIDR aggregation to improve performance and reduce memory usage ([#7685](https://github.com/kubernetes-sigs/cloud-provider-azure/pull/7685), [@k8s-infra-cherrypick-robot](https://github.com/k8s-infra-cherrypick-robot))

## Dependencies

### Added
- github.com/Azure/azure-sdk-for-go/sdk/azidentity/cache: [v0.3.1](https://github.com/Azure/azure-sdk-for-go/tree/sdk/azidentity/cache/v0.3.1)
- github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/compute/armcompute/v6: [v6.3.0](https://github.com/Azure/azure-sdk-for-go/tree/sdk/resourcemanager/compute/armcompute/v6/v6.3.0)
- github.com/AzureAD/microsoft-authentication-extensions-for-go/cache: [v0.1.1](https://github.com/AzureAD/microsoft-authentication-extensions-for-go/tree/cache/v0.1.1)
- github.com/dgryski/go-rendezvous: [9f7001d](https://github.com/dgryski/go-rendezvous/tree/9f7001d)
- github.com/keybase/go-keychain: [57a3676](https://github.com/keybase/go-keychain/tree/57a3676)
- github.com/redis/go-redis/v9: [v9.7.0](https://github.com/redis/go-redis/tree/v9.7.0)
- go.opentelemetry.io/auto/sdk: v1.1.0

### Changed
- github.com/Azure/azure-sdk-for-go/sdk/azcore: [v1.14.0 → v1.17.0](https://github.com/Azure/azure-sdk-for-go/compare/sdk/azcore/v1.14.0...sdk/azcore/v1.17.0)
- github.com/Azure/azure-sdk-for-go/sdk/azidentity: [v1.7.0 → v1.8.1](https://github.com/Azure/azure-sdk-for-go/compare/sdk/azidentity/v1.7.0...sdk/azidentity/v1.8.1)
- github.com/Azure/azure-sdk-for-go/sdk/containers/azcontainerregistry: [v0.2.1 → v0.2.2](https://github.com/Azure/azure-sdk-for-go/compare/sdk/containers/azcontainerregistry/v0.2.1...sdk/containers/azcontainerregistry/v0.2.2)
- github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/containerservice/armcontainerservice/v6: [v6.0.0 → v6.3.0](https://github.com/Azure/azure-sdk-for-go/compare/sdk/resourcemanager/containerservice/armcontainerservice/v6/v6.0.0...sdk/resourcemanager/containerservice/armcontainerservice/v6/v6.3.0)
- github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/network/armnetwork/v6: [v6.0.0 → v6.2.0](https://github.com/Azure/azure-sdk-for-go/compare/sdk/resourcemanager/network/armnetwork/v6/v6.0.0...sdk/resourcemanager/network/armnetwork/v6/v6.2.0)
- github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/privatedns/armprivatedns: [v1.2.0 → v1.3.0](https://github.com/Azure/azure-sdk-for-go/compare/sdk/resourcemanager/privatedns/armprivatedns/v1.2.0...sdk/resourcemanager/privatedns/armprivatedns/v1.3.0)
- github.com/Azure/azure-sdk-for-go/sdk/security/keyvault/azsecrets: [v1.1.0 → v1.3.0](https://github.com/Azure/azure-sdk-for-go/compare/sdk/security/keyvault/azsecrets/v1.1.0...sdk/security/keyvault/azsecrets/v1.3.0)
- github.com/Azure/azure-sdk-for-go/sdk/security/keyvault/internal: [v1.0.0 → v1.1.0](https://github.com/Azure/azure-sdk-for-go/compare/sdk/security/keyvault/internal/v1.0.0...sdk/security/keyvault/internal/v1.1.0)
- github.com/Azure/go-autorest/autorest/date: [v0.3.0 → v0.3.1](https://github.com/Azure/go-autorest/compare/autorest/date/v0.3.0...autorest/date/v0.3.1)
- github.com/Azure/go-autorest/autorest/mocks: [v0.4.2 → v0.4.3](https://github.com/Azure/go-autorest/compare/autorest/mocks/v0.4.2...autorest/mocks/v0.4.3)
- github.com/Azure/go-autorest/autorest: [v0.11.29 → v0.11.30](https://github.com/Azure/go-autorest/compare/autorest/v0.11.29...autorest/v0.11.30)
- github.com/Azure/go-autorest/tracing: [v0.6.0 → v0.6.1](https://github.com/Azure/go-autorest/compare/tracing/v0.6.0...tracing/v0.6.1)
- github.com/AzureAD/microsoft-authentication-library-for-go: [v1.2.2 → v1.3.2](https://github.com/AzureAD/microsoft-authentication-library-for-go/compare/v1.2.2...v1.3.2)
- github.com/evanphx/json-patch: [v5.9.0+incompatible → v5.9.11+incompatible](https://github.com/evanphx/json-patch/compare/v5.9.0...v5.9.11)
- github.com/fsnotify/fsnotify: [v1.7.0 → v1.8.0](https://github.com/fsnotify/fsnotify/compare/v1.7.0...v1.8.0)
- github.com/google/pprof: [fa2c70b → 40e02aa](https://github.com/google/pprof/compare/fa2c70b...40e02aa)
- github.com/onsi/ginkgo/v2: [v2.20.2 → v2.22.2](https://github.com/onsi/ginkgo/compare/v2.20.2...v2.22.2)
- github.com/onsi/gomega: [v1.34.2 → v1.36.2](https://github.com/onsi/gomega/compare/v1.34.2...v1.36.2)
- github.com/prometheus/client_golang: [v1.20.2 → v1.20.5](https://github.com/prometheus/client_golang/compare/v1.20.2...v1.20.5)
- github.com/prometheus/common: [v0.55.0 → v0.61.0](https://github.com/prometheus/common/compare/v0.55.0...v0.61.0)
- github.com/rogpeppe/go-internal: [v1.12.0 → v1.13.1](https://github.com/rogpeppe/go-internal/compare/v1.12.0...v1.13.1)
- github.com/spf13/pflag: [v1.0.5 → v1.0.6](https://github.com/spf13/pflag/compare/v1.0.5...v1.0.6)
- github.com/stretchr/testify: [v1.9.0 → v1.10.0](https://github.com/stretchr/testify/compare/v1.9.0...v1.10.0)
- go.opentelemetry.io/otel/exporters/prometheus: v0.50.0 → v0.56.0
- go.opentelemetry.io/otel/metric: v1.30.0 → v1.34.0
- go.opentelemetry.io/otel/sdk/metric: v1.29.0 → v1.34.0
- go.opentelemetry.io/otel/sdk: v1.29.0 → v1.34.0
- go.opentelemetry.io/otel/trace: v1.30.0 → v1.34.0
- go.opentelemetry.io/otel: v1.30.0 → v1.34.0
- go.uber.org/mock: v0.4.0 → v0.5.0
- golang.org/x/crypto: v0.27.0 → v0.33.0
- golang.org/x/mod: v0.20.0 → v0.22.0
- golang.org/x/net: v0.28.0 → v0.34.0
- golang.org/x/oauth2: v0.21.0 → v0.24.0
- golang.org/x/sync: v0.8.0 → v0.11.0
- golang.org/x/sys: v0.25.0 → v0.30.0
- golang.org/x/term: v0.24.0 → v0.29.0
- golang.org/x/text: v0.18.0 → v0.22.0
- golang.org/x/time: v0.6.0 → v0.10.0
- golang.org/x/tools: v0.24.0 → v0.28.0
- google.golang.org/protobuf: v1.34.2 → v1.36.3
- k8s.io/api: v0.31.1 → v0.31.3
- k8s.io/apimachinery: v0.31.1 → v0.31.3
- k8s.io/apiserver: v0.31.1 → v0.31.5
- k8s.io/client-go: v0.31.1 → v0.31.3
- k8s.io/cloud-provider: v0.31.1 → v0.31.5
- k8s.io/component-base: v0.31.1 → v0.31.5
- k8s.io/component-helpers: v0.31.1 → v0.31.5
- k8s.io/controller-manager: v0.31.1 → v0.31.5
- k8s.io/cri-api: v0.31.1 → v0.31.5
- k8s.io/gengo/v2: 51d4e06 → a7b603a
- k8s.io/kube-openapi: 7a9a4e8 → 32ad38e
- k8s.io/kubelet: v0.31.1 → v0.31.5
- k8s.io/utils: 18e509b → 3ea5e8c
- sigs.k8s.io/cloud-provider-azure/pkg/azclient/configloader: v0.0.27 → v0.3.4
- sigs.k8s.io/cloud-provider-azure/pkg/azclient: v0.0.56 → v0.4.16
- sigs.k8s.io/json: bc3834c → 9aa6b5e

### Removed
- github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/compute/armcompute/v5: [v5.7.0](https://github.com/Azure/azure-sdk-for-go/tree/sdk/resourcemanager/compute/armcompute/v5/v5.7.0)
