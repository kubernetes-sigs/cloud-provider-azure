<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.84.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/cloud-provider-azure/favicons/favicon.ico><link rel=apple-touch-icon href=/cloud-provider-azure/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/cloud-provider-azure/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/cloud-provider-azure/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/cloud-provider-azure/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/cloud-provider-azure/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/cloud-provider-azure/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/cloud-provider-azure/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/cloud-provider-azure/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/cloud-provider-azure/favicons/android-192x192.png sizes=192x192><title>AzureFile CSI Driver Known Issues | Cloud Provider Azure</title><meta name=description content="Cloud Provider Azure"><meta property="og:title" content="AzureFile CSI Driver Known Issues"><meta property="og:description" content="azure file plugin known issues  Recommended stable version for azure file 1. azure file mountOptions setting  file/dir mode setting: other useful mountOptions setting:   2. permission issue of azure file dynamic provision in acs-engine 3. Azure file support on Sovereign Cloud 4. azure file dynamic provision failed due to cluster name length issue 5. azure file dynamic provision failed due to no storage account in current resource group 6."><meta property="og:type" content="article"><meta property="og:url" content="https://kubernetes-sigs.github.io/cloud-provider-azure/faq/known-issues/azurefile/"><meta property="article:section" content="FAQ"><meta property="article:modified_time" content="2020-11-23T17:24:12+08:00"><meta property="og:site_name" content="Cloud Provider Azure"><meta itemprop=name content="AzureFile CSI Driver Known Issues"><meta itemprop=description content="azure file plugin known issues  Recommended stable version for azure file 1. azure file mountOptions setting  file/dir mode setting: other useful mountOptions setting:   2. permission issue of azure file dynamic provision in acs-engine 3. Azure file support on Sovereign Cloud 4. azure file dynamic provision failed due to cluster name length issue 5. azure file dynamic provision failed due to no storage account in current resource group 6."><meta itemprop=dateModified content="2020-11-23T17:24:12+08:00"><meta itemprop=wordCount content="1844"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="AzureFile CSI Driver Known Issues"><meta name=twitter:description content="azure file plugin known issues  Recommended stable version for azure file 1. azure file mountOptions setting  file/dir mode setting: other useful mountOptions setting:   2. permission issue of azure file dynamic provision in acs-engine 3. Azure file support on Sovereign Cloud 4. azure file dynamic provision failed due to cluster name length issue 5. azure file dynamic provision failed due to no storage account in current resource group 6."><link rel=preload href=/cloud-provider-azure/scss/main.min.bd5285b713d3061549a6bfd34e5f4ec6775ede36672a3088260f0d420050647f.css as=style><link href=/cloud-provider-azure/scss/main.min.bd5285b713d3061549a6bfd34e5f4ec6775ede36672a3088260f0d420050647f.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/cloud-provider-azure/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="-.17 .08 230.1 223.35"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#326ce5}</style></defs><path d="M134.358 126.466a3.59 3.59.0 00-.855-.065 3.685 3.685.0 00-1.425.37 3.725 3.725.0 00-1.803 4.825l-.026.037 8.528 20.603a43.53 43.53.0 0017.595-22.102l-21.976-3.714zm-34.194 2.92a3.72 3.72.0 00-3.568-2.894 3.656 3.656.0 00-.733.065l-.037-.045-21.785 3.698a43.695 43.695.0 0017.54 21.946l8.442-20.4-.066-.08a3.683 3.683.0 00.207-2.29zm18.245 8a3.718 3.718.0 00-6.557.008h-.018l-10.713 19.372a43.637 43.637.0 0023.815 1.225q2.197-.5 4.292-1.2l-10.738-19.406zm33.914-45-16.483 14.753.009.047a3.725 3.725.0 001.46 6.395l.02.089 21.35 6.15a44.278 44.278.0 00-6.356-27.432zM121.7 94.039a3.725 3.725.0 005.913 2.84l.065.027 18.036-12.788a43.85 43.85.0 00-25.287-12.19l1.253 22.105zm-19.1 2.921a3.72 3.72.0 005.904-2.85l.092-.043 1.253-22.14a44.682 44.682.0 00-4.501.776A43.467 43.467.0 0084.411 84.112l18.154 12.869zm-9.678 16.729a3.72 3.72.0 001.462-6.396l.018-.088-16.574-14.824a43.454 43.454.0 00-6.168 27.51l21.245-6.13zm16.098 6.512 6.114 2.94 6.096-2.934 1.514-6.581-4.219-5.276h-6.79l-4.231 5.268z" class="cls-2"/><path d="M216.208 133.167l-17.422-75.675a13.602 13.602.0 00-7.293-9.073l-70.521-33.67a13.589 13.589.0 00-11.705.0L38.76 48.437a13.598 13.598.0 00-7.295 9.072l-17.394 75.673a13.315 13.315.0 00-.004 5.81 13.506 13.506.0 00.491 1.718 13.1 13.1.0 001.343 2.726c.239.365.491.72.765 1.064l48.804 60.678c.213.264.448.505.681.75a13.423 13.423.0 002.574 2.133 13.924 13.924.0 003.857 1.677 13.298 13.298.0 003.43.473h.759l77.504-.018a12.993 12.993.0 001.41-.083 13.47 13.47.0 001.989-.378 13.872 13.872.0 001.381-.442c.353-.135.705-.27 1.045-.433a13.941 13.941.0 001.479-.822 13.303 13.303.0 003.237-2.865l1.488-1.85 47.299-58.84a13.185 13.185.0 002.108-3.785 13.67 13.67.0 00.5-1.724 13.282 13.282.0 00-.004-5.81zm-73.147 29.432a14.516 14.516.0 00.703 1.703 3.314 3.314.0 00-.327 2.49 39.372 39.372.0 003.742 6.7 35.06 35.06.0 012.263 3.364c.17.315.392.803.553 1.136a4.24 4.24.0 11-7.63 3.607c-.161-.33-.385-.77-.522-1.082a35.275 35.275.0 01-1.225-3.868 39.305 39.305.0 00-2.896-7.097 3.335 3.335.0 00-2.154-1.307c-.135-.233-.635-1.15-.903-1.623a54.617 54.617.0 01-38.948-.1l-.955 1.73a3.429 3.429.0 00-1.819.887 29.517 29.517.0 00-3.268 7.582 34.9 34.9.0 01-1.218 3.868c-.135.31-.361.744-.522 1.073v.009l-.007.008a4.238 4.238.0 11-7.619-3.616c.159-.335.372-.82.54-1.135a35.177 35.177.0 012.262-3.373 41.228 41.228.0 003.82-6.866 4.188 4.188.0 00-.376-2.387l.768-1.84a54.922 54.922.0 01-24.338-30.387l-1.839.313a4.68 4.68.0 00-2.428-.855 39.524 39.524.0 00-7.356 2.165 35.589 35.589.0 01-3.787 1.45c-.305.084-.745.168-1.093.244-.028.01-.052.022-.08.029a.605.605.0 01-.065.006 4.236 4.236.0 11-1.874-8.224l.061-.015.037-.01c.353-.083.805-.2 1.127-.262a35.27 35.27.0 014.05-.326 39.388 39.388.0 007.564-1.242 5.835 5.835.0 001.814-1.83l1.767-.516a54.613 54.613.0 018.613-38.073l-1.353-1.206a4.688 4.688.0 00-.848-2.436 39.366 39.366.0 00-6.277-4.41 35.25 35.25.0 01-3.499-2.046c-.256-.191-.596-.478-.874-.704l-.063-.044a4.473 4.473.0 01-1.038-6.222 4.066 4.066.0 013.363-1.488 5.03 5.03.0 012.942 1.11c.287.225.68.526.935.745a35.253 35.253.0 012.78 2.95 39.383 39.383.0 005.69 5.142 3.333 3.333.0 002.507.243q.754.55 1.522 1.082A54.289 54.289.0 01102.86 61.89a55.052 55.052.0 017.63-1.173l.1-1.784a4.6 4.6.0 001.37-2.184 39.476 39.476.0 00-.47-7.654 35.466 35.466.0 01-.576-4.014c-.011-.307.006-.731.01-1.081.0-.04-.01-.08-.01-.118a4.242 4.242.0 118.441-.004c0 .37.022.86.009 1.2a35.109 35.109.0 01-.579 4.013 39.533 39.533.0 00-.478 7.656 3.344 3.344.0 001.379 2.11c.015.305.065 1.323.102 1.884a55.309 55.309.0 0135.032 16.927l1.606-1.147a4.69 4.69.0 002.56-.278 39.532 39.532.0 005.69-5.148 35.004 35.004.0 012.787-2.95c.259-.222.65-.52.936-.746a4.242 4.242.0 115.258 6.598c-.283.229-.657.548-.929.75a35.095 35.095.0 01-3.507 2.046 39.495 39.495.0 00-6.277 4.41 3.337 3.337.0 00-.792 2.39c-.235.216-1.06.947-1.497 1.343a54.837 54.837.0 018.792 37.983l1.704.496a4.745 4.745.0 001.82 1.83 39.464 39.464.0 007.568 1.246 35.64 35.64.0 014.046.324c.355.065.868.207 1.23.29a4.236 4.236.0 11-1.878 8.223l-.061-.008c-.028-.007-.054-.022-.083-.03-.348-.075-.785-.151-1.09-.231a35.14 35.14.0 01-3.785-1.462 39.477 39.477.0 00-7.363-2.165 3.337 3.337.0 00-2.362.877q-.9-.171-1.804-.316a54.92 54.92.0 01-24.328 30.605z" class="cls-2"/><path d="M225.407 135.107 206.4 52.547a14.838 14.838.0 00-7.958-9.9l-76.935-36.73a14.825 14.825.0 00-12.771.0L31.808 42.669a14.838 14.838.0 00-7.961 9.895L4.873 135.129a14.668 14.668.0 001.995 11.185c.261.4.538.788.838 1.162l53.246 66.205a14.98 14.98.0 0011.499 5.487l85.387-.02a14.986 14.986.0 0011.5-5.48l53.227-66.211a14.72 14.72.0 002.842-12.347zm-9.197 3.866a13.677 13.677.0 01-.498 1.723 13.184 13.184.0 01-2.11 3.786l-47.299 58.838-1.486 1.852a13.305 13.305.0 01-3.24 2.865 13.945 13.945.0 01-1.474.822q-.513.237-1.045.43a13.873 13.873.0 01-1.383.445 13.473 13.473.0 01-1.989.379 12.988 12.988.0 01-1.41.082l-77.504.018h-.76a13.298 13.298.0 01-3.429-.472 13.925 13.925.0 01-3.855-1.679 13.424 13.424.0 01-2.576-2.132c-.233-.246-.468-.487-.68-.75l-48.805-60.679q-.408-.514-.765-1.066a13.102 13.102.0 01-1.343-2.726 13.505 13.505.0 01-.491-1.719 13.315 13.315.0 01.004-5.809l17.394-75.675a13.598 13.598.0 017.295-9.07l70.508-33.685a13.589 13.589.0 0111.705.0l70.519 33.67a13.602 13.602.0 017.293 9.073l17.422 75.674a13.282 13.282.0 01.002 5.807z" class="cls-1"/><path d="M185.814 127.106c-.36-.083-.874-.225-1.227-.29a35.642 35.642.0 00-4.046-.326 39.464 39.464.0 01-7.57-1.242 4.745 4.745.0 01-1.82-1.832l-1.704-.496a54.837 54.837.0 00-8.79-37.983c.436-.396 1.262-1.127 1.495-1.342a3.338 3.338.0 01.792-2.39 39.495 39.495.0 016.277-4.41 35.095 35.095.0 003.507-2.046c.272-.202.644-.522.929-.75a4.242 4.242.0 10-5.256-6.6c-.288.227-.68.525-.936.747a35.004 35.004.0 00-2.789 2.95 39.533 39.533.0 01-5.69 5.148 4.69 4.69.0 01-2.56.278l-1.606 1.147a55.309 55.309.0 00-35.032-16.927c-.039-.561-.087-1.577-.102-1.884a3.344 3.344.0 01-1.377-2.11 39.533 39.533.0 01.478-7.656 35.112 35.112.0 00.575-4.012c.013-.34-.007-.834-.007-1.201a4.242 4.242.0 10-8.441.004c0 .04.009.078.01.118-.004.35-.021.774-.01 1.08a35.476 35.476.0 00.576 4.015 39.475 39.475.0 01.47 7.654 4.601 4.601.0 01-1.37 2.182l-.1 1.786a55.052 55.052.0 00-7.63 1.173A54.289 54.289.0 0075.286 77.645q-.77-.531-1.526-1.082a3.333 3.333.0 01-2.506-.243 39.383 39.383.0 01-5.69-5.141 35.255 35.255.0 00-2.777-2.95c-.257-.22-.65-.52-.938-.75a5.03 5.03.0 00-2.942-1.11 4.066 4.066.0 00-3.363 1.49 4.473 4.473.0 001.038 6.222l.065.046c.276.226.616.515.872.702a35.256 35.256.0 003.499 2.048 39.367 39.367.0 016.276 4.412 4.69 4.69.0 01.849 2.434l1.351 1.208a54.613 54.613.0 00-8.611 38.073l-1.767.514a5.835 5.835.0 01-1.814 1.827 39.39 39.39.0 01-7.565 1.247 35.266 35.266.0 00-4.049.326c-.324.06-.774.174-1.127.262l-.037.008-.06.018a4.236 4.236.0 101.875 8.224l.063-.01c.028-.006.052-.02.08-.025.348-.08.786-.163 1.092-.246a35.59 35.59.0 003.786-1.451 39.527 39.527.0 017.358-2.165 4.68 4.68.0 012.426.857l1.84-.315a54.922 54.922.0 0024.34 30.387l-.769 1.84a4.188 4.188.0 01.377 2.387 41.228 41.228.0 01-3.82 6.864 35.183 35.183.0 00-2.263 3.372c-.168.318-.381.805-.542 1.138a4.238 4.238.0 107.621 3.616l.007-.008v-.01c.16-.33.387-.763.522-1.072a34.903 34.903.0 001.218-3.868 29.517 29.517.0 013.268-7.582 3.43 3.43.0 011.819-.888l.957-1.73a54.617 54.617.0 0038.946.099c.268.478.768 1.392.9 1.623a3.335 3.335.0 012.155 1.31 39.306 39.306.0 012.898 7.096 35.275 35.275.0 001.225 3.868c.137.312.36.75.522 1.082a4.24 4.24.0 107.63-3.607c-.161-.333-.383-.82-.55-1.136a35.06 35.06.0 00-2.263-3.364 39.372 39.372.0 01-3.742-6.7 3.314 3.314.0 01.324-2.49 14.519 14.519.0 01-.703-1.703 54.92 54.92.0 0024.328-30.605c.546.087 1.497.253 1.806.316a3.337 3.337.0 012.36-.877 39.476 39.476.0 017.36 2.165 35.135 35.135.0 003.788 1.462c.305.08.74.156 1.09.233.029.008.055.02.083.028l.06.009a4.236 4.236.0 101.878-8.224zm-40.1-42.987-18.037 12.787-.063-.03a3.723 3.723.0 01-5.913-2.838l-.02-.01-1.253-22.103a43.85 43.85.0 0125.285 12.194zm-33.978 24.228h6.788l4.22 5.276-1.513 6.58-6.096 2.934-6.114-2.94-1.516-6.583zm-6.386-35.648a44.672 44.672.0 014.503-.774l-1.255 22.137-.092.044a3.72 3.72.0 01-5.904 2.852l-.035.02-18.154-12.872a43.467 43.467.0 0120.937-11.407zm-27.52 19.68 16.574 14.824-.018.09a3.72 3.72.0 01-1.462 6.395l-.017.072-21.245 6.13a43.454 43.454.0 016.168-27.51zm22.191 39.38-8.441 20.397a43.696 43.696.0 01-17.536-21.948l21.783-3.7.037.049a3.655 3.655.0 01.73-.065 3.72 3.72.0 013.364 5.185zm24.916 26.23a43.637 43.637.0 01-23.815-1.223l10.713-19.372h.018a3.725 3.725.0 016.557-.006h.08l10.74 19.404q-2.091.698-4.293 1.199zm13.841-5.751-8.528-20.605.026-.037a3.725 3.725.0 011.803-4.823 3.685 3.685.0 011.425-.37 3.59 3.59.0 01.855.063l.037-.046 21.977 3.714a43.53 43.53.0 01-17.595 22.105zm19.903-32.42-21.352-6.15-.02-.09a3.725 3.725.0 01-1.46-6.395l-.008-.043 16.482-14.751a44.279 44.279.0 016.357 27.43z" class="cls-1"/></svg></span><span class="text-uppercase font-weight-bold">Cloud Provider Azure</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cloud-provider-azure/install/><span>Installation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cloud-provider-azure/development/><span>Development</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cloud-provider-azure/topics/><span>Topics</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cloud-provider-azure/contribute/><span>Contribution</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cloud-provider-azure/example/><span>Example</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cloud-provider-azure/blog/><span>Release Notes</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/cloud-provider-azure/faq/><span class=active>FAQ</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/cloud-provider-azure/offline-search-index.a3a103aedaae9f587d2e1b144b5cdd4b.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/cloud-provider-azure/offline-search-index.a3a103aedaae9f587d2e1b144b5cdd4b.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-cloud-provider-azurefaq-li><a href=/cloud-provider-azure/faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-cloud-provider-azurefaq><span>FAQ</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-cloud-provider-azurefaqknown-issues-li><a href=/cloud-provider-azure/faq/known-issues/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-cloud-provider-azurefaqknown-issues><span>Known Issues</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-cloud-provider-azurefaqknown-issuesazuredisk-li><a href=/cloud-provider-azure/faq/known-issues/azuredisk/ title="AzureDisk CSI Driver Known Issues" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-cloud-provider-azurefaqknown-issuesazuredisk><span>AzureDisk</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-cloud-provider-azurefaqknown-issuesazurefile-li><a href=/cloud-provider-azure/faq/known-issues/azurefile/ title="AzureFile CSI Driver Known Issues" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-cloud-provider-azurefaqknown-issuesazurefile><span class=td-sidebar-nav-active-item>AzureFile</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/kubernetes-sigs/cloud-provider-azure/edit/master/site/content/en/FAQ/known-issues/azurefile.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/kubernetes-sigs/cloud-provider-azure/new/master/site/content/en/FAQ/known-issues/azurefile.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/kubernetes-sigs/cloud-provider-azure/issues/new?title=AzureFile%20CSI%20Driver%20Known%20Issues" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/kubernetes-sigs/cloud-provider-azure/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#recommended-stable-version-for-azure-file>Recommended stable version for azure file</a></li><li><a href=#1-azure-file-mountoptions-setting>1. azure file mountOptions setting</a><ul><li><a href=#filedir-mode-setting>file/dir mode setting:</a></li><li><a href=#other-useful-mountoptions-setting>other useful <code>mountOptions</code> setting:</a></li></ul></li><li><a href=#2-permission-issue-of-azure-file-dynamic-provision-in-acs-engine>2. permission issue of azure file dynamic provision in acs-engine</a></li><li><a href=#3-azure-file-support-on-sovereign-cloud>3. Azure file support on Sovereign Cloud</a></li><li><a href=#4-azure-file-dynamic-provision-failed-due-to-cluster-name-length-issue>4. azure file dynamic provision failed due to cluster name length issue</a></li><li><a href=#5-azure-file-dynamic-provision-failed-due-to-no-storage-account-in-current-resource-group>5. azure file dynamic provision failed due to no storage account in current resource group</a></li><li><a href=#6-azure-file-plugin-on-windows-does-not-work-after-node-restart>6. azure file plugin on Windows does not work after node restart</a></li><li><a href=#7-file-permission-could-not-be-changed-using-azure-file-eg-postgresql>7. file permission could not be changed using azure file, e.g. postgresql</a></li><li><a href=#8-could-not-delete-pod-with-azurefile-volume-if-storage-account-key-changed>8. Could not delete pod with AzureFile volume if storage account key changed</a></li><li><a href=#9-long-latency-compared-to-disk-when-handling-lots-of-small-files>9. Long latency compared to disk when handling lots of small files</a></li><li><a href=#10-allow-access-from-selected-network-setting-on-storage-account-will-break-azure-file-dynamic-provisioning>10. <code>allow access from selected network</code> setting on storage account will break azure file dynamic provisioning</a></li><li><a href=#11-azure-file-remount-on-windows-in-same-node-would-fail>11. azure file remount on Windows in same node would fail</a></li><li><a href=#12-update-azure-file-secret-if-azure-storage-account-key-changed>12. update azure file secret if azure storage account key changed</a></li><li><a href=#13-create-azure-files-pv-authorizationfailure-when-using-advanced-networking>13. Create Azure Files PV AuthorizationFailure when using advanced networking</a></li><li><a href=#14-initial-delay5s-in-mounting-azure-file>14. initial delay(5s) in mounting azure file</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://kubernetes-sigs.github.io/cloud-provider-azure/faq/>FAQ</a></li><li class=breadcrumb-item><a href=https://kubernetes-sigs.github.io/cloud-provider-azure/faq/known-issues/>Known Issues</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://kubernetes-sigs.github.io/cloud-provider-azure/faq/known-issues/azurefile/>AzureFile</a></li></ol></nav><div class=td-content><h1>AzureFile CSI Driver Known Issues</h1><header class=article-meta></header><ul><li><a href=#azure-file-plugin-known-issues>azure file plugin known issues</a><ul><li><a href=#recommended-stable-version-for-azure-file>Recommended stable version for azure file</a></li><li><a href=#1-azure-file-mountoptions-setting>1. azure file mountOptions setting</a><ul><li><a href=#filedir-mode-setting>file/dir mode setting:</a></li><li><a href=#other-useful-mountoptions-setting>other useful <code>mountOptions</code> setting:</a></li></ul></li><li><a href=#2-permission-issue-of-azure-file-dynamic-provision-in-acs-engine>2. permission issue of azure file dynamic provision in acs-engine</a></li><li><a href=#3-azure-file-support-on-sovereign-cloud>3. Azure file support on Sovereign Cloud</a></li><li><a href=#4-azure-file-dynamic-provision-failed-due-to-cluster-name-length-issue>4. azure file dynamic provision failed due to cluster name length issue</a></li><li><a href=#5-azure-file-dynamic-provision-failed-due-to-no-storage-account-in-current-resource-group>5. azure file dynamic provision failed due to no storage account in current resource group</a></li><li><a href=#6-azure-file-plugin-on-windows-does-not-work-after-node-restart>6. azure file plugin on Windows does not work after node restart</a></li><li><a href=#7-file-permission-could-not-be-changed-using-azure-file-eg-postgresql>7. file permission could not be changed using azure file, e.g. postgresql</a></li><li><a href=#8-could-not-delete-pod-with-azurefile-volume-if-storage-account-key-changed>8. Could not delete pod with AzureFile volume if storage account key changed</a></li><li><a href=#9-long-latency-compared-to-disk-when-handling-lots-of-small-files>9. Long latency when handling lots of small files</a></li><li><a href=#10-allow-access-from-selected-network-setting-on-storage-account-will-break-azure-file-dynamic-provisioning>10. <code>allow access from selected network</code> setting on storage account will break azure file dynamic provisioning</a></li><li><a href=#11-azure-file-remount-on-windows-in-same-node-would-fail>11. azure file remount on Windows in same node would fail</a></li><li><a href=#12-update-azure-file-secret-if-azure-storage-account-key-changed>12. update azure file secret if azure storage account key changed</a></li><li><a href=#13-create-azure-files-pv-authorizationfailure-when-using-advanced-networking>13. Create Azure Files PV AuthorizationFailure when using advanced networking</a></li><li><a href=#14-initial-delay5s-in-mounting-azure-file>14. initial delay(5s) in mounting azure file</a></li></ul></li></ul><h2 id=recommended-stable-version-for-azure-file>Recommended stable version for azure file</h2><table><thead><tr><th>k8s version</th><th>stable version</th></tr></thead><tbody><tr><td>v1.7</td><td>1.7.14+</td></tr><tr><td>v1.8</td><td>1.8.11+</td></tr><tr><td>v1.9</td><td>1.9.7+</td></tr><tr><td>v1.10</td><td>1.10.2+</td></tr><tr><td>v1.11</td><td>1.11.8+</td></tr><tr><td>v1.12</td><td>1.12.6+</td></tr><tr><td>v1.13</td><td>1.13.4+</td></tr><tr><td>v1.14</td><td>1.14.0+</td></tr></tbody></table><h2 id=1-azure-file-mountoptions-setting>1. azure file mountOptions setting</h2><h3 id=filedir-mode-setting>file/dir mode setting:</h3><p><strong>Issue details</strong>:</p><ul><li><code>fileMode</code>, <code>dirMode</code> value would be different in different versions, in latest master branch, it&rsquo;s <code>0755</code> by default, to set a different value, follow this <a href=https://github.com/andyzhangx/Demo/blob/master/linux/azurefile/azurefile-mountoptions.md>mount options support of azure file</a> (available from v1.8.5).</li><li>For version v1.8.0-v1.8.4, since <a href=https://github.com/andyzhangx/Demo/blob/master/linux/azurefile/azurefile-mountoptions.md>mount options support of azure file</a> is not available, as a workaround, <a href=https://kubernetes.io/docs/tasks/configure-pod-container/security-context/>securityContext</a> could be specified for the pod, <a href=https://github.com/andyzhangx/Demo/blob/master/linux/azurefile/demo-azurefile-securitycontext.yaml>detailed pod example</a></li></ul><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>securityContext</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>runAsUser</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>XXX</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>fsGroup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>XXX</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><table><thead><tr><th>version</th><th><code>fileMode</code>, <code>dirMode</code> value</th></tr></thead><tbody><tr><td>v1.6.x, v1.7.x</td><td>0777</td></tr><tr><td>v1.8.0 ~ v1.8.5, v1.9.0</td><td>0700</td></tr><tr><td>v1.8.6 or later, v1.9.1 ~ v1.10.9, v1.11.0 ~ v1.11.3, v1.12.0 ~ v.12.1</td><td>0755</td></tr><tr><td>v1.10.10 or later</td><td>0777</td></tr><tr><td>v1.11.4 or later</td><td>0777</td></tr><tr><td>v1.12.2 or later</td><td>0777</td></tr><tr><td>v1.13.x</td><td>0777</td></tr></tbody></table><h3 id=other-useful-mountoptions-setting>other useful <code>mountOptions</code> setting:</h3><ul><li><code>mfsymlinks</code>: make azure file(cifs) mount supports symbolic link</li><li><code>nobrl</code>: Do not send byte range lock requests to the server. This is necessary for certain applications that break with cifs style mandatory byte range locks (and most cifs servers do not yet support requesting advisory byte range locks). Error message could be like following:</li></ul><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Error: SQLITE_BUSY: database is locked
</code></pre></div><p><strong>Related issues</strong></p><ul><li><a href=https://github.com/kubernetes/kubernetes/issues/54610>azureFile volume mode too strict for container with non root user</a></li><li><a href=https://github.com/kubernetes/kubernetes/issues/59755>Unable to connect to SQL-lite db mounted on AzureFile/AzureDisks [SQLITE_BUSY: database is locked]</a></li><li><a href=https://github.com/kubernetes/kubernetes/issues/61767>Allow nobrl parameter like docker to use sqlite over network drive</a></li><li><a href=https://github.com/kubernetes/kubernetes/issues/58308>Error to deploy mongo with azure file storage</a></li></ul><h2 id=2-permission-issue-of-azure-file-dynamic-provision-in-acs-engine>2. permission issue of azure file dynamic provision in acs-engine</h2><p><strong>Issue details</strong>:</p><p>From acs-engine v0.12.0, RBAC is enabled, azure file dynamic provision does not work from this version</p><p><strong>error logs</strong>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Events:
  Type     Reason              Age   From                         Message
  ----     ------              ----  ----                         -------
  Warning  ProvisioningFailed  8s    persistentvolume-controller  Failed to provision volume with StorageClass <span style=color:#4e9a06>&#34;azurefile&#34;</span>: Couldn<span style=color:#a40000>&#39;</span>t create secret secrets is forbidden: User <span style=color:#4e9a06>&#34;system:serviceaccount:kube-syste
</span><span style=color:#4e9a06>m:persistent-volume-binder&#34;</span> cannot create secrets in the namespace <span style=color:#4e9a06>&#34;default&#34;</span>
  Warning  ProvisioningFailed  8s    persistentvolume-controller  Failed to provision volume with StorageClass <span style=color:#4e9a06>&#34;azurefile&#34;</span>: failed to find a matching storage account
</code></pre></div><p><strong>Related issues</strong></p><ul><li><a href=https://github.com/kubernetes/kubernetes/issues/59543>azure file PVC need secrets create permission for persistent-volume-binder</a></li></ul><p><strong>Workaround</strong>:</p><ul><li>Add a ClusterRole and ClusterRoleBinding for <a href=https://github.com/andyzhangx/Demo/tree/master/linux/azurefile#dynamic-provisioning-for-azure-file-in-linux-support-from-v170>azure file dynamic privision</a></li></ul><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl create -f https://raw.githubusercontent.com/andyzhangx/Demo/master/aks-engine/rbac/azure-cloud-provider-deployment.yaml
</code></pre></div><ul><li>delete the original PVC and recreate PVC</li></ul><p><strong>Fix</strong></p><ul><li>PR in acs-engine: <a href=https://github.com/Azure/acs-engine/pull/2238>fix azure file dynamic provision permission issue</a></li></ul><h2 id=3-azure-file-support-on-sovereign-cloud>3. Azure file support on Sovereign Cloud</h2><p><a href=https://github.com/kubernetes/kubernetes/pull/48460>Azure file on Sovereign Cloud</a> is supported from v1.7.11, v1.8.0</p><h2 id=4-azure-file-dynamic-provision-failed-due-to-cluster-name-length-issue>4. azure file dynamic provision failed due to cluster name length issue</h2><p><strong>Issue details</strong>:
k8s cluster name length must be less than 16 characters, otherwise following error will be received when creating dynamic privisioning azure file pvc, this bug exists in [v1.7.0, v1.7.10]:</p><blockquote><p>Note: check <code>cluster-name</code> by running <code>grep cluster-name /etc/kubernetes/manifests/kube-controller-manager.yaml</code> on master node</p></blockquote><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>persistentvolume-controller    Warning    ProvisioningFailed Failed to provision volume with StorageClass <span style=color:#4e9a06>&#34;azurefile&#34;</span>: failed to find a matching storage account
</code></pre></div><p><strong>Fix</strong></p><ul><li>PR <a href=https://github.com/kubernetes/kubernetes/pull/48326>Fix share name generation in azure file provisioner</a></li></ul><table><thead><tr><th>k8s version</th><th>fixed version</th></tr></thead><tbody><tr><td>v1.7</td><td>1.7.11</td></tr><tr><td>v1.8</td><td>1.8.0</td></tr><tr><td>v1.9</td><td>1.9.0</td></tr></tbody></table><h2 id=5-azure-file-dynamic-provision-failed-due-to-no-storage-account-in-current-resource-group>5. azure file dynamic provision failed due to no storage account in current resource group</h2><p><strong>Issue details</strong>:</p><p>When create an azure file PVC, there will be error if there is no storage account in current resource group, error info would be like following:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Events:
  Type     Reason              Age               From                         Message
  ----     ------              ----              ----                         -------
  Warning  ProvisioningFailed  10s <span style=color:#ce5c00;font-weight:700>(</span>x5 over 1m<span style=color:#ce5c00;font-weight:700>)</span>  persistentvolume-controller  Failed to provision volume with StorageClass <span style=color:#4e9a06>&#34;azurefile-premium&#34;</span>: failed to find a matching storage account
</code></pre></div><p><strong>Related issues</strong></p><ul><li><a href=https://github.com/kubernetes/kubernetes/issues/56556>failed to create azure file pvc if there is no storage account in current resource group</a></li></ul><p><strong>Workaround</strong>:
specify a storage account in azure file dynamic provision, you should make sure the specified storage account is in the same resource group as your k8s cluster. In AKS, the specified storage account should be in <code>shadow resource group</code>(naming as <code>MC_+{RESOUCE-GROUP-NAME}+{CLUSTER-NAME}+{REGION}</code>) which contains all resources of your aks cluster.</p><p><strong>Fix</strong></p><ul><li>PR <a href=https://github.com/kubernetes/kubernetes/pull/56557>fix the create azure file pvc failure if there is no storage account in current resource group</a></li></ul><table><thead><tr><th>k8s version</th><th>fixed version</th></tr></thead><tbody><tr><td>v1.7</td><td>1.7.14</td></tr><tr><td>v1.8</td><td>1.8.9</td></tr><tr><td>v1.9</td><td>1.9.4</td></tr><tr><td>v1.10</td><td>1.10.0</td></tr></tbody></table><h2 id=6-azure-file-plugin-on-windows-does-not-work-after-node-restart>6. azure file plugin on Windows does not work after node restart</h2><p><strong>Issue details</strong>:
azure file plugin on Windows does not work after node restart, this is due to <code>New-SmbGlobalMapping</code> cmdlet has lost account name/key after reboot</p><p><strong>Related issues</strong></p><ul><li><a href=https://github.com/kubernetes/kubernetes/issues/60624>azure file plugin on Windows does not work after node restart</a></li></ul><p><strong>Workaround</strong>:</p><ul><li>delete the original pod with azure file mount</li><li>create the pod again</li></ul><p><strong>Fix</strong></p><ul><li>PR <a href=https://github.com/kubernetes/kubernetes/pull/60625>fix azure file plugin failure issue on Windows after node restart</a></li></ul><table><thead><tr><th>k8s version</th><th>fixed version</th></tr></thead><tbody><tr><td>v1.7</td><td>not support in upstream</td></tr><tr><td>v1.8</td><td>1.8.10</td></tr><tr><td>v1.9</td><td>1.9.7</td></tr><tr><td>v1.10</td><td>1.10.0</td></tr></tbody></table><h2 id=7-file-permission-could-not-be-changed-using-azure-file-eg-postgresql>7. file permission could not be changed using azure file, e.g. postgresql</h2><p><strong>error logs</strong> when running postgresql on azure file plugin:</p><pre><code>initdb: could not change permissions of directory &quot;/var/lib/postgresql/data&quot;: Operation not permitted
fixing permissions on existing directory /var/lib/postgresql/data
</code></pre><p><strong>Issue details</strong>:
azure file plugin is using cifs/SMB protocol, file/dir permission could not be changed after mounting</p><p><strong>Workaround</strong>:</p><p>Use <code>mountOptions</code> with <code>dir_mode</code>, <code>file_mode</code> set as <code>0777</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StorageClass</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>storage.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>azurefile</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>provisioner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kubernetes.io/azure-file</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>mountOptions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>dir_mode=0777</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>file_mode=0777</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><blockquote><p>follow detailed config <a href=../linux/azurefile/postgresql>here</a></p></blockquote><p><strong>Related issues</strong>
<a href=https://github.com/Azure/AKS/issues/225>Persistent Volume Claim permissions</a></p><h2 id=8-could-not-delete-pod-with-azurefile-volume-if-storage-account-key-changed>8. Could not delete pod with AzureFile volume if storage account key changed</h2><p><strong>Issue details</strong>:</p><ul><li>kubelet fails to umount azurefile volume when there is azure file connection, below is an easy repro:<ul><li>create a pod with azure file mount</li><li>regenerate the account key of the storage account</li><li>delete the pod, and the pod will never be deleted due to <code>UnmountVolume.TearDown</code> error</li></ul></li></ul><p><strong>error logs</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>nestedpendingoperations.go:263<span style=color:#ce5c00;font-weight:700>]</span> Operation <span style=color:#204a87;font-weight:700>for</span> <span style=color:#4e9a06>&#34;\&#34;kubernetes.io/azure-file/cc5c86cd-422a-11e8-91d7-000d3a03ee84-myvolume\&#34; (\&#34;cc5c86cd-422a-11e8-91d7-000d3a03ee84\&#34;)&#34;</span> failed. No retries permitted <span style=color:#204a87;font-weight:700>until</span> 2018-04-17 10:35:40.240272223 +0000 UTC <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>=</span>+1185722.391925424 <span style=color:#ce5c00;font-weight:700>(</span>durationBeforeRetry 500ms<span style=color:#ce5c00;font-weight:700>)</span>. Error: <span style=color:#4e9a06>&#34;UnmountVolume.TearDown failed for volume \&#34;myvolume\&#34; (UniqueName: \&#34;kubernetes.io/azure-file/cc5c86cd-422a-11e8-91d7-000d3a03ee84-myvolume\&#34;) pod \&#34;cc5c86cd-422a-11e8-91d7-000d3a03ee84\&#34; (UID: \&#34;cc5c86cd-422a-11e8-91d7-000d3a03ee84\&#34;) : Error checking if path exists: stat /var/lib/kubelet/pods/cc5c86cd-422a-11e8-91d7-000d3a03ee84/volumes/kubernetes.io~azure-file/myvolume: resource temporarily unavailable
</span><span style=color:#4e9a06>...
</span><span style=color:#4e9a06>kubelet_volumes.go:128] Orphaned pod &#34;</span>380b02f3-422b-11e8-91d7-000d3a03ee84<span style=color:#4e9a06>&#34; found, but volume paths are still present on disk
</span></code></pre></div><p><strong>Workaround</strong>:</p><p>manually umount the azure file mount path on the agent node and then the pod will be deleted right after that</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo umount /var/lib/kubelet/pods/cc5c86cd-422a-11e8-91d7-000d3a03ee84/volumes/kubernetes.io~azure-file/myvolume
</code></pre></div><p><strong>Fix</strong></p><ul><li>PR <a href=https://github.com/kubernetes/kubernetes/pull/52324>Fix bug:Kubelet failure to umount mount points</a></li></ul><table><thead><tr><th>k8s version</th><th>fixed version</th></tr></thead><tbody><tr><td>v1.7</td><td>no fix(no cherry-pick fix is allowed)</td></tr><tr><td>v1.8</td><td>1.8.8</td></tr><tr><td>v1.9</td><td>1.9.7</td></tr><tr><td>v1.10</td><td>1.10.0</td></tr></tbody></table><p><strong>Related issues</strong></p><ul><li><a href=https://github.com/kubernetes/kubernetes/issues/62824>UnmountVolume.TearDown fails for AzureFile volume, locks up node</a></li><li><a href=https://github.com/kubernetes/kubernetes/issues/41141>Kubelet failure to umount glusterfs mount points</a></li></ul><h2 id=9-long-latency-compared-to-disk-when-handling-lots-of-small-files>9. Long latency compared to disk when handling lots of small files</h2><p><strong>Related issues</strong></p><ul><li><a href=https://github.com/Azure/AKS/issues/223><code>azurefile</code> is very slow</a></li><li><a href=https://github.com/helm/charts/issues/5751>Can&rsquo;t roll out Wordpress chart with PV on AzureFile</a></li></ul><h2 id=10-allow-access-from-selected-network-setting-on-storage-account-will-break-azure-file-dynamic-provisioning>10. <code>allow access from selected network</code> setting on storage account will break azure file dynamic provisioning</h2><p>When set <code>allow access from selected network</code> on storage account and will get following error when creating a file share by k8s:</p><pre><code>persistentvolume-controller (combined from similar events): Failed to provision volume with StorageClass &quot;azurefile&quot;: failed to create share kubernetes-dynamic-pvc-xxx in account xxx: failed to create file share, err: storage: service returned error: StatusCode=403, ErrorCode=AuthorizationFailure, ErrorMessage=This request is not authorized to perform this operation.
</code></pre><p>That&rsquo;s because k8s <code>persistentvolume-controller</code> is on master node which is not in the selected network, and that&rsquo;s why it could not create file share on that storage account.</p><p><strong>Workaround</strong>:</p><p>use azure file static provisioning instead</p><ul><li>create azure file share in advance, and then provide storage account and file share name in k8s, here is an <a href=https://docs.microsoft.com/en-us/azure/aks/azure-files-volume>example</a></li></ul><p><strong>Related issues</strong></p><ul><li><a href=https://github.com/Azure/AKS/issues/804>Azure Files PV AuthorizationFailure when using advanced networking</a></li></ul><h2 id=11-azure-file-remount-on-windows-in-same-node-would-fail>11. azure file remount on Windows in same node would fail</h2><p><strong>Issue details</strong>:</p><p>If user delete a pod with azure file mount in deployment and it would probably schedule a pod on same node, azure file mount will fail since <code>New-SmbGlobalMapping</code> command would fail if file share is already mounted on the node.</p><p><strong>error logs</strong></p><p>Error logs would be like following:</p><pre><code>E0118 08:15:52.041014    2112 nestedpendingoperations.go:267] Operation for &quot;\&quot;kubernetes.io/azure-file/42c0ea39-1af9-11e9-8941-000d3af95268-pvc-d7e1b5f9-1af3-11e9-8941-000d3af95268\&quot; (\&quot;42c0ea39-1af9-11e9-8941-000d3af95268\&quot;)&quot; failed. No retries permitted until 2019-01-18 08:15:53.0410149 +0000 GMT m=+732.446642701 (durationBeforeRetry 1s). Error: &quot;MountVolume.SetUp failed for volume \&quot;pvc-d7e1b5f9-1af3-11e9-8941-000d3af95268\&quot; (UniqueName: \&quot;kubernetes.io/azure-file/42c0ea39-1af9-11e9-8941-000d3af95268-pvc-d7e1b5f9-1af3-11e9-8941-000d3af95268\&quot;) pod \&quot;deployment-azurefile-697f98d559-6zrlf\&quot; (UID: \&quot;42c0ea39-1af9-11e9-8941-000d3af95268\&quot;) : azureMount: SmbGlobalMapping failed: exit status 1, only SMB mount is supported now, output: \&quot;New-SmbGlobalMapping : Generic failure \\r\\nAt line:1 char:190\\r\\n+ ... ser, $PWord;New-SmbGlobalMapping -RemotePath $Env:smbremotepath -Cred ...\\r\\n+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\r\\n    + CategoryInfo          : NotSpecified: (MSFT_SmbGlobalMapping:ROOT/Microsoft/...mbGlobalMapping) [New-SmbGlobalMa \\r\\n   pping], CimException\\r\\n    + FullyQualifiedErrorId : HRESULT 0x80041001,New-SmbGlobalMapping\\r\\n \\r\\n\&quot;&quot;
</code></pre><p><strong>Fix</strong></p><ul><li>PR <a href=https://github.com/kubernetes/kubernetes/pull/73661>fix smb remount issue on Windows</a></li></ul><table><thead><tr><th>k8s version</th><th>fixed version</th></tr></thead><tbody><tr><td>v1.10</td><td>no fix</td></tr><tr><td>v1.11</td><td>1.11.8</td></tr><tr><td>v1.12</td><td>1.12.6</td></tr><tr><td>v1.13</td><td>1.13.4</td></tr><tr><td>v1.14</td><td>1.14.0</td></tr></tbody></table><p><strong>Related issues</strong></p><ul><li><a href=https://github.com/kubernetes/kubernetes/issues/73087>azure file remount on Windows in same node would fail</a></li><li><a href=https://github.com/Azure/aks-engine/issues/327>Mounting volume to pods fails randomly</a></li></ul><h2 id=12-update-azure-file-secret-if-azure-storage-account-key-changed>12. update azure file secret if azure storage account key changed</h2><p><strong>Issue details</strong>:
There would be azure file mount failure if azure storage account key changed</p><p><strong>Workaround</strong>:
User needs to update <code>azurestorageaccountkey</code> field manually in azure file secret(secret name format: <code>azure-storage-account-{storage-account-name}-secret</code> in <code>default</code> namespace):</p><pre><code>kubectl delete secret azure-storage-account-{storage-account-name}-secret
kubectl create secret generic azure-storage-account-{storage-account-name}-secret --from-literal azurestorageaccountname=... --from-literal azurestorageaccountkey=&quot;...&quot; --type=Opaque
</code></pre><blockquote><p>make sure there is no <code>\r</code> in the account name and key, here is a <a href=https://github.com/MicrosoftDocs/azure-docs/issues/61650#issuecomment-683274588>failed case</a></p></blockquote><ul><li>delete original pod(may use <code>--force --grace-period=0</code>) and wait a few minutes for new pod retry azure file mount</li></ul><h2 id=13-create-azure-files-pv-authorizationfailure-when-using-advanced-networking>13. Create Azure Files PV AuthorizationFailure when using advanced networking</h2><p><strong>Issue details</strong>:</p><p>When create an azure file PV using advanced networking, user may hit following error:</p><pre><code>err: storage: service returned error: StatusCode=403, ErrorCode=AuthorizationFailure, ErrorMessage=This request is not authorized to perform this operation
</code></pre><p>Before api-version <code>2019-06-01</code>, create file share action is considered as data-path operation, since <code>2019-06-01</code>, it would be considered as control-path operation, not blocked by advanced networking any more.</p><p><strong>Related issues</strong></p><ul><li><a href=https://github.com/Azure/AKS/issues/804>Azure Files PV AuthorizationFailure when using advanced networking</a></li><li><a href=https://github.com/kubernetes/kubernetes/issues/85354>Azure Files PV AuthorizationFailure when using advanced networking</a></li></ul><p><strong>Fix</strong></p><ul><li>PR <a href=https://github.com/kubernetes/kubernetes/pull/90350>Switch to use AzureFile management SDK</a></li></ul><table><thead><tr><th>k8s version</th><th>fixed version</th></tr></thead><tbody><tr><td>v1.18</td><td>no fix</td></tr><tr><td>v1.19</td><td>1.19.0</td></tr></tbody></table><p><strong>Workaround</strong>:</p><p>Shut down the advanced networking when create azure file PV.</p><h2 id=14-initial-delay5s-in-mounting-azure-file>14. initial delay(5s) in mounting azure file</h2><p><strong>Issue details</strong>:</p><p>When starting pods with AFS volumes, there is an initial delay of five seconds until the pod is transitioning from the &ldquo;Scheduled&rdquo; state. The reason for this is that currently the volume mounting happens inside a wait.Poll which will initially wait a specified interval(currently 5 seconds) before execution. This issue is introduced by PR <a href=https://github.com/kubernetes/kubernetes/pull/88610>fix: azure file mount timeout issue</a> with v1.15.11+, v1.16.8+, v1.17.4+, v1.18.0+</p><p><strong>Fix</strong></p><ul><li><a href=https://github.com/kubernetes/kubernetes/issues/93025>initial delay(5s) when starting Pods with Azure File volumes</a></li></ul><p><strong>Fix</strong></p><ul><li>PR <a href=https://github.com/kubernetes/kubernetes/pull/93052>fix: initial delay in mounting azure disk & file</a></li></ul><table><thead><tr><th>k8s version</th><th>fixed version</th></tr></thead><tbody><tr><td>v1.15</td><td>no fix</td></tr><tr><td>v1.16</td><td>1.16.14</td></tr><tr><td>v1.17</td><td>1.17.10</td></tr><tr><td>v1.18</td><td>1.18.7</td></tr><tr><td>v1.19</td><td>1.19.0</td></tr></tbody></table><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/USERNAME/REPOSITORY/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/USERNAME/REPOSITORY/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector('.feedback--answer-yes'),noButton=document.querySelector('.feedback--answer-no'),yesResponse=document.querySelector('.feedback--response-yes'),noResponse=document.querySelector('.feedback--response-no'),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=b=>{if(typeof ga!='function')return;const a={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:b};ga(a.command,a.hitType,a.category,a.action,a.label,a.value)};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(1)}),noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified
November 23, 2020
: <a href=https://github.com/kubernetes-sigs/cloud-provider-azure/commit/af5c2382f2fa043e178cee1e0eb2552df9f474b7>Update azurefile.md (af5c2382)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Google Group" aria-label="Google Group"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/kubernetes-sig-cloud-provider aria-label="Google Group"><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/kubernetes-sigs/cloud-provider-azure aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The Kubernetes Authors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/cloud-provider-azure/js/main.min.3b172c13b62c2bea8b1c9d2599cddc8cf89718a92d792c680871c81ba43d8c85.js integrity="sha256-OxcsE7YsK+qLHJ0lmc3cjPiXGKkteSxoCHHIG6Q9jIU=" crossorigin=anonymous></script></body></html>